@startuml F1 Analytics Class Diagram

' Core Domain Models
class Driver {
  +driver_id: UUID
  +driver_number: int
  +name: str
  +team_id: UUID
  +nationality: str
  +date_of_birth: date
  +career_stats: CareerStats
  +get_performance_rating(circuit_id: UUID): float
  +get_historical_results(circuit_id: UUID): List[RaceResult]
}

class Team {
  +team_id: UUID
  +name: str
  +constructor_id: UUID
  +drivers: List[Driver]
  +car_performance: CarPerformance
  +get_season_stats(year: int): TeamStats
}

class Circuit {
  +circuit_id: UUID
  +name: str
  +country: str
  +length_km: float
  +lap_record: LapTime
  +overtaking_difficulty: int
  +drs_zones: List[DRSZone]
  +corners: List[Corner]
  +get_historical_winners(): List[Driver]
}

class RaceEvent {
  +event_id: UUID
  +season_year: int
  +round_number: int
  +circuit_id: UUID
  +event_date: datetime
  +event_type: EventType
  +weather: WeatherCondition
  +sessions: List[Session]
  +get_live_data(): LiveRaceData
}

class Session {
  +session_id: UUID
  +event_id: UUID
  +session_type: SessionType
  +start_time: datetime
  +status: SessionStatus
  +lap_data: List[LapTime]
  +telemetry: List[TelemetryData]
  +get_current_standings(): List[DriverPosition]
}

' Telemetry Models
class TelemetryData {
  +telemetry_id: UUID
  +session_id: UUID
  +driver_id: UUID
  +timestamp: datetime
  +lap_number: int
  +distance: float
  +speed: float
  +rpm: int
  +gear: int
  +throttle: float
  +brake: float
  +drs_status: bool
  +tire_temps: TireTemperatures
  +validate(): bool
}

class LapTime {
  +lap_id: UUID
  +session_id: UUID
  +driver_id: UUID
  +lap_number: int
  +lap_time: float
  +sector_times: List[float]
  +tire_compound: TireCompound
  +tire_age: int
  +is_valid: bool
  +get_pace_delta(baseline: float): float
}

' Prediction Models
interface IPredictionModel {
  +predict(features: Dict): PredictionResult
  +get_confidence(): float
  +explain(method: str): ExplanationResult
}

class LapTimePredictionModel {
  +model_version: str
  +model_type: str
  +features: List[str]
  +predict(features: Dict): PredictionResult
  +get_confidence(): float
  +explain(method: str): ExplanationResult
  -load_model(): Model
  -preprocess_features(features: Dict): np.ndarray
}

class RacePositionPredictionModel {
  +model_version: str
  +model_type: str
  +features: List[str]
  +predict(features: Dict): PredictionResult
  +get_confidence(): float
  +explain(method: str): ExplanationResult
  +get_position_probabilities(): Dict[int, float]
}

class PredictionResult {
  +prediction_id: UUID
  +model_version: str
  +prediction_value: float
  +confidence_score: float
  +timestamp: datetime
  +features_used: Dict
  +explanation: ExplanationResult
  +to_dict(): Dict
}

class ExplanationResult {
  +shap_values: Dict[str, float]
  +lime_explanation: str
  +feature_importance: Dict[str, float]
  +confidence_interval: Tuple[float, float]
  +visualize(): Figure
}

' Strategy Models
class StrategySimulator {
  +race_laps: int
  +num_simulations: int
  +tire_deg_rates: Dict[TireCompound, float]
  +pit_stop_loss: float
  +simulate_strategy(strategy: List[StrategyOption], context: RaceContext): SimulationResult
  +compare_strategies(strategies: List[List[StrategyOption]], context: RaceContext): List[SimulationResult]
  -run_single_simulation(strategy: List[StrategyOption], context: RaceContext): int
  -calculate_lap_time(stint: StrategyOption, lap: int, conditions: Dict): float
}

class SimulationResult {
  +strategy: List[StrategyOption]
  +expected_position: float
  +position_probabilities: Dict[int, float]
  +time_delta: float
  +confidence: float
  +get_podium_probability(): float
}

class BattleForecastSystem {
  +detect_active_battles(session: Session): List[Battle]
  +predict_overtake(battle: Battle): OvertakePrediction
  +calculate_closing_rate(attacker: Driver, defender: Driver): float
  +get_drs_effectiveness(circuit: Circuit): float
  -calculate_pace_differential(attacker: Driver, defender: Driver): float
}

class Battle {
  +battle_id: UUID
  +session_id: UUID
  +attacker: Driver
  +defender: Driver
  +current_gap: float
  +intensity_score: int
  +championship_impact: str
  +is_active(): bool
}

class CarPerformanceScorer {
  +calculate_overall_score(team: Team, circuit: Circuit): float
  +get_component_scores(team: Team, circuit: Circuit): Dict[str, float]
  +analyze_corner_performance(team: Team, circuit: Circuit): Dict[Corner, float]
  +track_development(team: Team, season: int): List[DevelopmentUpdate]
  -score_aerodynamics(telemetry: List[TelemetryData]): float
  -score_power_unit(telemetry: List[TelemetryData]): float
}

' Service Interfaces
interface IRaceService {
  +get_live_race(): RaceEvent
  +get_race_results(event_id: UUID): List[RaceResult]
  +get_session_data(session_id: UUID): Session
}

interface IPredictionService {
  +predict_lap_time(driver_id: UUID, session_id: UUID): PredictionResult
  +predict_race_position(driver_id: UUID, event_id: UUID): PredictionResult
  +predict_overtake(battle_id: UUID): OvertakePrediction
}

interface IStrategyService {
  +simulate_strategy(strategy: List[StrategyOption], context: RaceContext): SimulationResult
  +optimize_pit_stop(driver_id: UUID, race_id: UUID): PitWindow
  +recommend_tire_strategy(driver_id: UUID, race_id: UUID): TireStrategy
}

' Relationships
Driver "1" -- "1" Team : belongs to
Team "1" -- "*" Driver : has
RaceEvent "1" -- "1" Circuit : held at
RaceEvent "1" -- "*" Session : contains
Session "1" -- "*" LapTime : records
Session "1" -- "*" TelemetryData : generates

IPredictionModel <|.. LapTimePredictionModel : implements
IPredictionModel <|.. RacePositionPredictionModel : implements

LapTimePredictionModel "1" -- "*" PredictionResult : generates
PredictionResult "1" -- "1" ExplanationResult : includes

StrategySimulator "1" -- "*" SimulationResult : produces
BattleForecastSystem "1" -- "*" Battle : detects
CarPerformanceScorer "1" -- "1" Team : analyzes

IRaceService ..> RaceEvent : provides
IPredictionService ..> PredictionResult : provides
IStrategyService ..> SimulationResult : provides

@enduml
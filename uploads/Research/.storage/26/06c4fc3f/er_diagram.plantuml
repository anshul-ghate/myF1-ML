@startuml F1 Analytics ER Diagram

' Core Entities
entity "drivers" as drivers {
  * driver_id : uuid <<PK>>
  --
  * driver_number : int
  * name : varchar(100)
  * team_id : uuid <<FK>>
  * nationality : varchar(50)
  * date_of_birth : date
  career_starts : int
  career_wins : int
  career_podiums : int
  created_at : timestamp
}

entity "teams" as teams {
  * team_id : uuid <<PK>>
  --
  * name : varchar(100)
  * constructor_id : uuid
  * full_name : varchar(200)
  * chassis : varchar(50)
  * power_unit : varchar(50)
  created_at : timestamp
}

entity "circuits" as circuits {
  * circuit_id : uuid <<PK>>
  --
  * name : varchar(100)
  * country : varchar(50)
  * length_km : decimal(5,3)
  * turns : int
  * overtaking_difficulty : int
  latitude : decimal(9,6)
  longitude : decimal(9,6)
}

entity "race_events" as race_events {
  * event_id : uuid <<PK>>
  --
  * season_year : int
  * round_number : int
  * circuit_id : uuid <<FK>>
  * event_name : varchar(100)
  * event_date : date
  status : varchar(20)
  created_at : timestamp
}

entity "sessions" as sessions {
  * session_id : uuid <<PK>>
  --
  * event_id : uuid <<FK>>
  * session_type : varchar(20)
  * start_time : timestamp
  * status : varchar(20)
  * weather_conditions : jsonb
  * track_temperature : decimal(4,1)
  created_at : timestamp
}

entity "lap_times" as lap_times {
  * lap_id : uuid <<PK>>
  --
  * session_id : uuid <<FK>>
  * driver_id : uuid <<FK>>
  * lap_number : int
  * lap_time : decimal(6,3)
  * sector_1_time : decimal(5,3)
  * sector_2_time : decimal(5,3)
  * sector_3_time : decimal(5,3)
  * tire_compound : varchar(20)
  * tire_age : int
  created_at : timestamp
}

entity "telemetry_data" as telemetry_data {
  * telemetry_id : uuid <<PK>>
  --
  * session_id : uuid <<FK>>
  * driver_id : uuid <<FK>>
  * timestamp : timestamp
  * lap_number : int
  * speed : decimal(5,1)
  * rpm : int
  * gear : int
  * throttle : decimal(5,2)
  * brake : decimal(5,2)
  * drs_status : boolean
}

entity "predictions" as predictions {
  * prediction_id : uuid <<PK>>
  --
  * session_id : uuid <<FK>>
  * driver_id : uuid <<FK>>
  * prediction_type : varchar(50)
  * prediction_value : decimal(10,3)
  * confidence_score : decimal(5,4)
  * timestamp_created : timestamp
  * model_version : varchar(50)
  * features_used : jsonb
  * shap_values : jsonb
}

entity "strategy_simulations" as strategy_simulations {
  * simulation_id : uuid <<PK>>
  --
  * race_id : uuid <<FK>>
  * driver_id : uuid <<FK>>
  * strategy_config : jsonb
  * num_simulations : int
  * expected_position : decimal(5,2)
  * position_probabilities : jsonb
  * confidence : decimal(5,4)
  created_at : timestamp
}

entity "battles" as battles {
  * battle_id : uuid <<PK>>
  --
  * session_id : uuid <<FK>>
  * attacker_id : uuid <<FK>>
  * defender_id : uuid <<FK>>
  * start_lap : int
  * initial_gap : decimal(5,3)
  * intensity_score : int
  * status : varchar(20)
  created_at : timestamp
}

entity "users" as users {
  * user_id : uuid <<PK>>
  --
  * email : varchar(255)
  * username : varchar(100)
  * password_hash : varchar(255)
  * subscription_tier : varchar(20)
  * favorite_driver_id : uuid <<FK>>
  * preferences : jsonb
  created_at : timestamp
}

' Relationships
drivers ||--o{ teams : "team_id"
circuits ||--o{ race_events : "circuit_id"
race_events ||--o{ sessions : "event_id"
sessions ||--o{ lap_times : "session_id"
sessions ||--o{ telemetry_data : "session_id"
drivers ||--o{ lap_times : "driver_id"
drivers ||--o{ telemetry_data : "driver_id"
sessions ||--o{ predictions : "session_id"
drivers ||--o{ predictions : "driver_id"
race_events ||--o{ strategy_simulations : "race_id"
drivers ||--o{ strategy_simulations : "driver_id"
sessions ||--o{ battles : "session_id"
drivers ||--o{ battles : "attacker_id, defender_id"
users }o--|| drivers : "favorite_driver_id"

@enduml